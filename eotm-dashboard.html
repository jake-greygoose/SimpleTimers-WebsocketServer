<!DOCTYPE html>
<html lang="en" data-theme="night">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EOTM Assist Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@2.51.5/dist/full.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
  <style>
    :root {
      --surface: #0f172a;
      --surface-2: #111827;
      --surface-3: #1f2937;
      --accent: #22d3ee;
      --accent-strong: #0ea5e9;
      --danger: #f43f5e;
    }

    body {
      background: radial-gradient(circle at top, #0b1226, #0a0f1f 50%, #060912 100%);
    }

    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .panel {
      background: linear-gradient(145deg, rgba(17, 24, 39, 0.95), rgba(15, 23, 42, 0.9));
      border: 1px solid rgba(148, 163, 184, 0.15);
      box-shadow: 0 20px 40px rgba(2, 6, 23, 0.45);
    }

    .stat-card {
      background: rgba(15, 23, 42, 0.65);
      border: 1px solid rgba(148, 163, 184, 0.18);
      border-radius: 0.75rem;
      padding: 1rem;
    }

    .action-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
    }

    .btn.pending {
      pointer-events: none;
      opacity: 0.7;
      position: relative;
    }

    .btn.pending::after {
      content: "";
      position: absolute;
      right: 0.5rem;
      top: 50%;
      width: 0.45rem;
      height: 0.45rem;
      border-radius: 9999px;
      background: var(--accent);
      transform: translateY(-50%);
      animation: pulse 1.1s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }
  </style>
</head>
<body class="text-gray-100 p-3 sm:p-6">
  <div class="max-w-6xl mx-auto">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
      <div>
        <h1 class="text-2xl sm:text-3xl font-semibold tracking-tight">EOTM Control Deck</h1>
        <p class="text-sm text-slate-300">Locate live map instances, focus clients, and manage multiâ€‘PC account coverage.</p>
      </div>
      <div class="flex items-center gap-2 text-xs text-slate-300">
        <span id="connection-dot" class="inline-flex h-2 w-2 rounded-full bg-rose-500"></span>
        <span id="connection-label">Offline</span>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
      <div class="stat-card">
        <div class="text-sm text-gray-400">Total Clients</div>
        <div id="total-clients" class="text-3xl font-bold">0</div>
      </div>
      <div class="stat-card">
        <div class="text-sm text-gray-400">Active Instances</div>
        <div id="total-instances" class="text-3xl font-bold">0</div>
      </div>
      <div class="stat-card">
        <div class="text-sm text-gray-400">Active Machines</div>
        <div id="total-machines" class="text-3xl font-bold">0</div>
      </div>
    </div>

    <div class="panel p-4 mb-6">
      <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4">
        <div>
          <h2 class="text-lg font-semibold">Action Dock</h2>
          <p class="text-xs text-slate-400">Bulk commands for organizing instances and machines.</p>
        </div>
        <div class="flex items-center gap-2">
          <button id="refresh-btn" class="btn btn-sm btn-outline action-btn">
            <i class="fa-solid fa-rotate"></i>
            Refresh
          </button>
        </div>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-3">
        <div class="flex gap-2">
          <input id="close-excess-count" type="number" min="0" value="2" class="input input-bordered flex-1 bg-gray-800" placeholder="Keep per instance">
          <button id="close-excess-btn" class="btn btn-warning action-btn">
            <i class="fa-solid fa-scissors"></i>
            Close Excess
          </button>
        </div>
        <div class="flex gap-2">
          <input id="keep-per-machine-count" type="number" min="0" value="5" class="input input-bordered flex-1 bg-gray-800" placeholder="Keep per machine">
          <button id="keep-per-machine-btn" class="btn btn-warning action-btn">
            <i class="fa-solid fa-network-wired"></i>
            Keep Per Machine
          </button>
        </div>
        <div class="flex gap-2">
          <input id="set-fps-value" type="number" min="1" max="200" value="15" class="input input-bordered flex-1 bg-gray-800" placeholder="FPS">
          <button id="set-fps-btn" class="btn btn-info action-btn">
            <i class="fa-solid fa-gauge-high"></i>
            Set FPS All
          </button>
        </div>
        <div class="flex gap-2">
          <button id="minimize-all-btn" class="btn btn-secondary action-btn flex-1">
            <i class="fa-regular fa-window-minimize"></i>
            Minimize All
          </button>
          <button id="focus-all-btn" class="btn btn-secondary action-btn flex-1">
            <i class="fa-solid fa-eye"></i>
            Focus All
          </button>
        </div>
        <div class="flex gap-2">
          <button id="reconnect-outside-btn" class="btn btn-accent action-btn flex-1">
            <i class="fa-solid fa-plug-circle-bolt"></i>
            Reconnect Outside
          </button>
          <button id="request-status-unknown-btn" class="btn btn-outline action-btn flex-1">
            <i class="fa-solid fa-satellite-dish"></i>
            Request Status
          </button>
        </div>
        <div class="flex gap-2">
          <button id="disable-fps-btn" class="btn btn-info action-btn flex-1">
            <i class="fa-solid fa-lock-open"></i>
            Unlock FPS
          </button>
          <button id="close-all-btn" class="btn btn-error action-btn flex-1">
            <i class="fa-solid fa-ban"></i>
            Close All
          </button>
        </div>
      </div>
    </div>

    <div class="panel p-4">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-3">
        <div>
          <h2 class="text-lg font-semibold">Live Discovery</h2>
          <p class="text-xs text-slate-400">Switch between instance and machine views to target accounts fast.</p>
        </div>
        <div class="flex items-center gap-2">
          <div class="join">
            <button id="instances-tab" class="btn btn-sm join-item btn-primary">Instances</button>
            <button id="machines-tab" class="btn btn-sm join-item btn-outline">Machines</button>
          </div>
          <span id="list-hint" class="text-xs text-gray-400 hidden sm:inline">Instances grouped by server IP</span>
        </div>
      </div>
      <div id="instances-list" class="space-y-3"></div>
      <div id="machines-list" class="space-y-3 hidden"></div>
    </div>

    <div class="panel p-4 mt-6">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold">Outside EOTM</h2>
        <span class="text-xs text-gray-400">Clients without an active instance</span>
      </div>
      <div id="outside-list" class="space-y-3"></div>
    </div>
  </div>

  <script>
    let ws;
    let wsUrl = buildDefaultWsUrl();
    let reconnectTimer = null;
    let statusTimer = null;
    let reconnectAttempts = 0;
    const pendingButtons = new Set();

    const connectionDot = document.getElementById('connection-dot');
    const connectionLabel = document.getElementById('connection-label');
    const totalClients = document.getElementById('total-clients');
    const totalInstances = document.getElementById('total-instances');
    const totalMachines = document.getElementById('total-machines');
    const instancesList = document.getElementById('instances-list');
    const machinesList = document.getElementById('machines-list');
    const outsideList = document.getElementById('outside-list');

    function buildDefaultWsUrl() {
      const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
      return `${protocol}//${location.host}/eotm/admin`;
    }

    function setStatusBadge(connected) {
      connectionDot.className = connected ? 'inline-flex h-2 w-2 rounded-full bg-emerald-400' : 'inline-flex h-2 w-2 rounded-full bg-rose-500';
      connectionLabel.textContent = connected ? 'Connected' : 'Offline';
    }

    function connect() {
      if (ws && ws.readyState === WebSocket.OPEN) return;
      setStatusBadge(false);
      ws = new WebSocket(wsUrl);

      ws.onopen = () => {
        setStatusBadge(true);
        reconnectAttempts = 0;
        sendMessage({ type: 'request_status' });
      };

      ws.onclose = () => {
        setStatusBadge(false);
        scheduleReconnect();
      };

      ws.onerror = () => {
        setStatusBadge(false);
      };

      ws.onmessage = (event) => {
        let message;
        try {
          message = JSON.parse(event.data);
        } catch (err) {
          return;
        }

        if (message.type === 'status') {
          renderStatus(message);
          clearPendingButtons();
        }
      };
    }

    function scheduleReconnect() {
      if (reconnectTimer) return;
      const delay = Math.min(10000, 1000 * Math.pow(1.6, reconnectAttempts));
      reconnectAttempts += 1;
      reconnectTimer = setTimeout(() => {
        reconnectTimer = null;
        connect();
      }, delay);
    }

    function startStatusPolling() {
      if (statusTimer) return;
      statusTimer = setInterval(() => {
        sendMessage({ type: 'request_status' });
      }, 5000);
    }

    function stopStatusPolling() {
      if (!statusTimer) return;
      clearInterval(statusTimer);
      statusTimer = null;
    }

    function setButtonPending(button, key, duration = 800) {
      if (!button) return;
      const pendingKey = key || button.id || button.textContent;
      if (pendingButtons.has(pendingKey)) return;
      pendingButtons.add(pendingKey);
      button.disabled = true;
      button.classList.add('pending');
      setTimeout(() => {
        button.disabled = false;
        button.classList.remove('pending');
        pendingButtons.delete(pendingKey);
      }, duration);
    }

    function clearPendingButtons() {
      document.querySelectorAll('button.pending').forEach((button) => {
        button.classList.remove('pending');
        button.disabled = false;
      });
      pendingButtons.clear();
    }

    function sendMessage(message) {
      if (!ws || ws.readyState !== WebSocket.OPEN) return;
      ws.send(JSON.stringify(message));
    }

    function renderStatus(status) {
      const instances = status.instances || {};
      const machines = status.machines || {};
      const outside = status.outside || [];

      totalClients.textContent = status.total_clients || 0;
      totalInstances.textContent = Object.keys(instances).length;
      totalMachines.textContent = Object.keys(machines).length;

      instancesList.innerHTML = '';
      Object.entries(instances).forEach(([serverIp, clients]) => {
        const container = document.createElement('div');
        container.className = 'bg-gray-700 rounded p-3';

        const header = document.createElement('div');
        header.className = 'flex items-center justify-between gap-2 mb-2';
        header.innerHTML = `<div><span class="font-semibold mono">${serverIp}</span> <span class="text-xs text-gray-300">(${clients.length})</span></div>`;

        const closeBtn = document.createElement('button');
        closeBtn.className = 'btn btn-xs btn-warning';
        closeBtn.textContent = 'Close Server';
        closeBtn.addEventListener('click', () => sendMessage({ type: 'close_server', server_ip: serverIp }));

        header.appendChild(closeBtn);
        container.appendChild(header);

        const list = document.createElement('div');
        list.className = 'space-y-1 text-sm';
        clients.forEach(client => {
          const row = document.createElement('div');
          row.className = 'flex items-center justify-between bg-gray-800 rounded px-2 py-1 gap-2';
          const accountLabel = client.account ? ` <span class="text-xs text-gray-400">(${client.account})</span>` : '';
          const label = document.createElement('div');
          label.innerHTML = `${client.character}${accountLabel} <span class="text-xs text-gray-400">@ ${client.machine}</span>`;

          const actions = document.createElement('div');
          actions.className = 'flex items-center gap-1 flex-wrap justify-end';

          const focusBtn = document.createElement('button');
          focusBtn.className = 'btn btn-xs';
          focusBtn.textContent = 'Focus';
          focusBtn.addEventListener('click', () => {
            setButtonPending(focusBtn, `focus-${client.machine}-${client.character}-${client.account || ''}`, 800);
            sendMessage({ type: 'focus_client', character: client.character, machine: client.machine, account: client.account || null });
          });

          const minimizeBtn = document.createElement('button');
          minimizeBtn.className = 'btn btn-xs';
          minimizeBtn.textContent = 'Minimize';
          minimizeBtn.addEventListener('click', () => {
            setButtonPending(minimizeBtn, `minimize-${client.machine}-${client.character}-${client.account || ''}`, 800);
            sendMessage({ type: 'minimize_client', character: client.character, machine: client.machine, account: client.account || null });
          });

          const fpsBtn = document.createElement('button');
          fpsBtn.className = 'btn btn-xs btn-info';
          fpsBtn.textContent = 'Unlock FPS';
          fpsBtn.addEventListener('click', () => {
            setButtonPending(fpsBtn, `fps-${client.machine}-${client.character}-${client.account || ''}`, 800);
            sendMessage({ type: 'disable_fps_client', character: client.character, machine: client.machine, account: client.account || null });
          });

          const closeChar = document.createElement('button');
          closeChar.className = 'btn btn-xs btn-outline btn-error';
          closeChar.textContent = 'Close';
          closeChar.addEventListener('click', () => {
            setButtonPending(closeChar, `close-${client.machine}-${client.character}-${client.account || ''}`, 800);
            sendMessage({ type: 'close_client', character: client.character, machine: client.machine, account: client.account || null });
          });

          actions.appendChild(focusBtn);
          actions.appendChild(minimizeBtn);
          actions.appendChild(fpsBtn);
          actions.appendChild(closeChar);
          row.appendChild(label);
          row.appendChild(actions);
          list.appendChild(row);
        });

        container.appendChild(list);
        instancesList.appendChild(container);
      });

      if (Object.keys(instances).length === 0) {
        instancesList.innerHTML = '<div class="text-sm text-gray-400">No active instances.</div>';
      }

      machinesList.innerHTML = '';
      Object.entries(machines).forEach(([machine, clients]) => {
        const container = document.createElement('div');
        container.className = 'bg-gray-700 rounded p-3';

        const header = document.createElement('div');
        header.className = 'flex items-center justify-between gap-2 mb-2';
        header.innerHTML = `<div><span class="font-semibold">${machine}</span> <span class="text-xs text-gray-300">(${clients.length})</span></div>`;

        const actionGroup = document.createElement('div');
        actionGroup.className = 'flex items-center gap-1';

        const focusBtn = document.createElement('button');
        focusBtn.className = 'btn btn-xs btn-secondary';
        focusBtn.textContent = 'Focus';
        focusBtn.addEventListener('click', () => sendMessage({ type: 'focus_machine', machine }));

        const minimizeBtn = document.createElement('button');
        minimizeBtn.className = 'btn btn-xs btn-secondary';
        minimizeBtn.textContent = 'Minimize';
        minimizeBtn.addEventListener('click', () => sendMessage({ type: 'minimize_machine', machine }));

        const closeBtn = document.createElement('button');
        closeBtn.className = 'btn btn-xs btn-warning';
        closeBtn.textContent = 'Close';
        closeBtn.addEventListener('click', () => sendMessage({ type: 'close_machine', machine }));

        actionGroup.appendChild(focusBtn);
        actionGroup.appendChild(minimizeBtn);
        actionGroup.appendChild(closeBtn);
        header.appendChild(actionGroup);
        container.appendChild(header);

        const list = document.createElement('div');
        list.className = 'space-y-1 text-sm';
        clients.forEach(client => {
          const row = document.createElement('div');
          row.className = 'flex items-center justify-between bg-gray-800 rounded px-2 py-1 gap-2';
          const accountLabel = client.account ? ` <span class="text-xs text-gray-400">(${client.account})</span>` : '';
          const label = document.createElement('div');
          label.innerHTML = `${client.character}${accountLabel} <span class="text-xs text-gray-400">@ ${client.server_ip || 'unknown'}</span>`;

          const actions = document.createElement('div');
          actions.className = 'flex items-center gap-1 flex-wrap justify-end';

          const focusBtn = document.createElement('button');
          focusBtn.className = 'btn btn-xs';
          focusBtn.textContent = 'Focus';
          focusBtn.addEventListener('click', () => {
            setButtonPending(focusBtn, `focus-${client.machine}-${client.character}-${client.account || ''}`, 800);
            sendMessage({ type: 'focus_client', character: client.character, machine: client.machine, account: client.account || null });
          });

          const minimizeBtn = document.createElement('button');
          minimizeBtn.className = 'btn btn-xs';
          minimizeBtn.textContent = 'Minimize';
          minimizeBtn.addEventListener('click', () => {
            setButtonPending(minimizeBtn, `minimize-${client.machine}-${client.character}-${client.account || ''}`, 800);
            sendMessage({ type: 'minimize_client', character: client.character, machine: client.machine, account: client.account || null });
          });

          const fpsBtn = document.createElement('button');
          fpsBtn.className = 'btn btn-xs btn-info';
          fpsBtn.textContent = 'Unlock FPS';
          fpsBtn.addEventListener('click', () => {
            setButtonPending(fpsBtn, `fps-${client.machine}-${client.character}-${client.account || ''}`, 800);
            sendMessage({ type: 'disable_fps_client', character: client.character, machine: client.machine, account: client.account || null });
          });

          const closeChar = document.createElement('button');
          closeChar.className = 'btn btn-xs btn-outline btn-error';
          closeChar.textContent = 'Close';
          closeChar.addEventListener('click', () => {
            setButtonPending(closeChar, `close-${client.machine}-${client.character}-${client.account || ''}`, 800);
            sendMessage({ type: 'close_client', character: client.character, machine: client.machine, account: client.account || null });
          });

          actions.appendChild(focusBtn);
          actions.appendChild(minimizeBtn);
          actions.appendChild(fpsBtn);
          actions.appendChild(closeChar);
          row.appendChild(label);
          row.appendChild(actions);
          list.appendChild(row);
        });

        container.appendChild(list);
        machinesList.appendChild(container);
      });

      if (Object.keys(machines).length === 0) {
        machinesList.innerHTML = '<div class="text-sm text-gray-400">No active machines.</div>';
      }

      outsideList.innerHTML = '';
      if (outside.length === 0) {
        outsideList.innerHTML = '<div class="text-sm text-gray-400">All clients are currently in EOTM.</div>';
      } else {
        outside.forEach(client => {
          const container = document.createElement('div');
          container.className = 'bg-gray-700 rounded p-3';

          const accountLabel = client.account ? ` <span class="text-xs text-gray-400">(${client.account})</span>` : '';
          const reasonLabel = client.leave_reason ? ` <span class="text-xs text-gray-400">Reason: ${client.leave_reason}</span>` : '';
          const lastServer = client.last_server_ip ? ` <span class="text-xs text-gray-400">Last: ${client.last_server_ip}</span>` : '';
          const reconnectStatus = client.reconnect_status ? ` <span class="text-xs text-gray-400">Status: ${client.reconnect_status}${client.reconnect_reason ? ` (${client.reconnect_reason})` : ''}</span>` : '';

          const header = document.createElement('div');
          header.className = 'flex items-center justify-between gap-2';
          header.innerHTML = `<div>${client.character}${accountLabel} <span class="text-xs text-gray-400">@ ${client.machine}</span>${lastServer}${reasonLabel}${reconnectStatus}</div>`;

          const buttonGroup = document.createElement('div');
          buttonGroup.className = 'flex items-center gap-1';

          const focusBtn = document.createElement('button');
          focusBtn.className = 'btn btn-xs';
          focusBtn.textContent = 'Focus';
          focusBtn.addEventListener('click', () => {
            setButtonPending(focusBtn, `focus-${client.machine}-${client.character}-${client.account || ''}`, 800);
            sendMessage({ type: 'focus_client', character: client.character, machine: client.machine, account: client.account || null });
          });

          const minimizeBtn = document.createElement('button');
          minimizeBtn.className = 'btn btn-xs';
          minimizeBtn.textContent = 'Minimize';
          minimizeBtn.addEventListener('click', () => {
            setButtonPending(minimizeBtn, `minimize-${client.machine}-${client.character}-${client.account || ''}`, 800);
            sendMessage({ type: 'minimize_client', character: client.character, machine: client.machine, account: client.account || null });
          });

          const fpsBtn = document.createElement('button');
          fpsBtn.className = 'btn btn-xs btn-info';
          fpsBtn.textContent = 'Unlock FPS';
          fpsBtn.addEventListener('click', () => {
            setButtonPending(fpsBtn, `fps-${client.machine}-${client.character}-${client.account || ''}`, 800);
            sendMessage({ type: 'disable_fps_client', character: client.character, machine: client.machine, account: client.account || null });
          });

          const reconnectBtn = document.createElement('button');
          reconnectBtn.className = 'btn btn-xs btn-accent';
          reconnectBtn.textContent = 'Reconnect';
          const shouldDisable = client.reconnect_status === 'reconnect_started';
          if (shouldDisable) {
            reconnectBtn.disabled = true;
            reconnectBtn.classList.add('pending');
          }
          reconnectBtn.addEventListener('click', () => {
            setButtonPending(reconnectBtn, `reconnect-${client.machine}-${client.character}-${client.account || ''}`, 1500);
            sendMessage({
              type: 'reconnect_client',
              character: client.character,
              machine: client.machine,
            account: client.account || null
          });
        });

          const requestBtn = document.createElement('button');
          requestBtn.className = 'btn btn-xs';
          requestBtn.textContent = 'Request Update';
          requestBtn.addEventListener('click', () => {
            setButtonPending(requestBtn, `request-${client.machine}-${client.character}-${client.account || ''}`, 1200);
            sendMessage({
              type: 'request_status_client',
              character: client.character,
              machine: client.machine,
            account: client.account || null
          });
        });

          const closeBtn = document.createElement('button');
          closeBtn.className = 'btn btn-xs btn-outline btn-error';
          closeBtn.textContent = 'Close';
          closeBtn.addEventListener('click', () => {
            setButtonPending(closeBtn, `close-${client.machine}-${client.character}-${client.account || ''}`, 800);
            sendMessage({ type: 'close_client', character: client.character, machine: client.machine, account: client.account || null });
          });

          buttonGroup.appendChild(requestBtn);
          buttonGroup.appendChild(focusBtn);
          buttonGroup.appendChild(minimizeBtn);
          buttonGroup.appendChild(fpsBtn);
          buttonGroup.appendChild(reconnectBtn);
          buttonGroup.appendChild(closeBtn);
          header.appendChild(buttonGroup);
          container.appendChild(header);
          outsideList.appendChild(container);
        });
      }
    }

    document.getElementById('refresh-btn').addEventListener('click', (event) => {
      setButtonPending(event.currentTarget, 'refresh-status', 500);
      sendMessage({ type: 'request_status' });
    });

    const instancesTab = document.getElementById('instances-tab');
    const machinesTab = document.getElementById('machines-tab');
    const listHint = document.getElementById('list-hint');

    function setActiveList(tab) {
      if (tab === 'instances') {
        instancesTab.classList.add('btn-primary');
        instancesTab.classList.remove('btn-outline');
        machinesTab.classList.remove('btn-primary');
        machinesTab.classList.add('btn-outline');
        instancesList.classList.remove('hidden');
        machinesList.classList.add('hidden');
        listHint.textContent = 'Instances grouped by server IP';
      } else {
        machinesTab.classList.add('btn-primary');
        machinesTab.classList.remove('btn-outline');
        instancesTab.classList.remove('btn-primary');
        instancesTab.classList.add('btn-outline');
        machinesList.classList.remove('hidden');
        instancesList.classList.add('hidden');
        listHint.textContent = 'Machines grouped by host';
      }
    }

    instancesTab.addEventListener('click', () => setActiveList('instances'));
    machinesTab.addEventListener('click', () => setActiveList('machines'));

    document.getElementById('close-excess-btn').addEventListener('click', (event) => {
      setButtonPending(event.currentTarget, 'close-excess', 800);
      const keepCount = Number(document.getElementById('close-excess-count').value || 0);
      sendMessage({ type: 'close_excess', keep_count: keepCount });
    });

    document.getElementById('keep-per-machine-btn').addEventListener('click', (event) => {
      setButtonPending(event.currentTarget, 'keep-per-machine', 800);
      const keepCount = Number(document.getElementById('keep-per-machine-count').value || 0);
      sendMessage({ type: 'keep_per_machine', keep_count: keepCount });
    });

    document.getElementById('set-fps-btn').addEventListener('click', (event) => {
      setButtonPending(event.currentTarget, 'set-fps-all', 800);
      const fps = Number(document.getElementById('set-fps-value').value || 15);
      sendMessage({ type: 'set_fps_all', fps });
    });

    document.getElementById('disable-fps-btn').addEventListener('click', (event) => {
      setButtonPending(event.currentTarget, 'disable-fps', 800);
      sendMessage({ type: 'disable_fps_limiter_all' });
    });

    document.getElementById('close-all-btn').addEventListener('click', (event) => {
      setButtonPending(event.currentTarget, 'close-all', 800);
      sendMessage({ type: 'close_all' });
    });

    document.getElementById('minimize-all-btn').addEventListener('click', (event) => {
      setButtonPending(event.currentTarget, 'minimize-all', 800);
      sendMessage({ type: 'minimize_all' });
    });

    document.getElementById('focus-all-btn').addEventListener('click', (event) => {
      setButtonPending(event.currentTarget, 'focus-all', 800);
      sendMessage({ type: 'focus_all' });
    });

    document.getElementById('reconnect-outside-btn').addEventListener('click', (event) => {
      setButtonPending(event.currentTarget, 'reconnect-outside', 1200);
      sendMessage({ type: 'reconnect_all_outside' });
    });

    document.getElementById('request-status-unknown-btn').addEventListener('click', (event) => {
      setButtonPending(event.currentTarget, 'request-status-unknown', 1200);
      sendMessage({ type: 'request_status_unknown' });
    });

    connect();
    startStatusPolling();
  </script>
</body>
</html>
